!function(a){function b(a,b){this._key=a,this._modifierKeys=b,this._callback=null,this._id=Math.floor(1e6*Math.random())}function c(a){this._children=[],this._state=a}function d(){this._rootNode=new c}function e(a){return console.log(a),o&&"keydown"===o.type&&o.keyCode===a.keyCode?void(o=a):(o=a,s.push(a.keyCode),void f())}function f(){var a=(new Date).getTime();a-m<q.timeThreshold&&clearTimeout(n),m=a,n=setTimeout(i,q.timeThreshold)}function g(a){o=a;var b=h();b.hasChildMatchingKeySequence(s)&&(r.push(b.getChildIndexMatchingKeySequence(s)),h().getState().hasCallback()&&(h().getState().executeCallback(),i())),s.splice(s.indexOf(a.keyCode),1)}function h(){return t.getStateTreeNodeAtIndexPath(r)}function i(){r=[]}function j(a){function c(a){var i=t.getStateTreeNodeAtIndexPath(h);return i.hasChildMatchingStateKeys(f,g)?h.push(i.getChildIndexMatchingStateKeys(f,g)):(i.addChild(new b(f,g)),h.push(i.getChildren().length-1)),f=p[a],g=[],{then:c,withModifier:d,perform:e}}function d(a){return g.push(p[a]),{then:c,withModifier:d,perform:e}}function e(a){var c=t.getStateTreeNodeAtIndexPath(h);if(c.hasChildMatchingStateKeys(f,g))c.getChildMatchingStateKeys(f,g).getState().setCallback(a),h.push(c.getChildIndexMatchingStateKeys(f,g));else{var d=new b(f,g);d.setCallback(a),c.addChild(d),h.push(c.getChildren().length-1)}for(var e=h.slice(),i=[],j=0;j<e.length;j++){var k=e.slice(0,j+1);i.push(t.getStateTreeNodeAtIndexPath(k).getState().getId())}return function(){t.getStateTreeNodeAtStateIdPath(i).getState().removeCallback(),t.pruneBranch(i)}}var f="",g=[],h=[];return f=p[a],{then:c,withModifier:d,perform:e}}function k(a){for(var b in q)a.hasOwnProperty(b)&&(q[b]=a[b])}function l(){t.clear()}b.prototype.doesMatchKeySequence=function(a){if(a.length!==this._modifierKeys.length+1)return!1;var b=a[this._modifierKeys.length],c=a.slice(0,this._modifierKeys.length);return this.doesMatchStateKeys(b,c)},b.prototype.doesMatchStateKeys=function(a,b){var c=this._key===a,d=this._modifierKeys.every(function(a){return-1!==b.indexOf(a)})&&this._modifierKeys.length===b.length;return c&&d},b.prototype.setCallback=function(a){this._callback=a},b.prototype.executeCallback=function(){this._callback.call(null)},b.prototype.hasCallback=function(){return null!==this._callback},b.prototype.removeCallback=function(){this._callback=null},b.prototype.getId=function(){return this._id},c.prototype.hasChildMatchingKeySequence=function(a){return-1!==this.getChildIndexMatchingKeySequence(a)},c.prototype.getChildIndexMatchingKeySequence=function(a){var b=-1;return this._children.forEach(function(c,d){c.getState().doesMatchKeySequence(a)&&(b=d)}),b},c.prototype.hasChildMatchingStateKeys=function(a,b){return-1!==this.getChildIndexMatchingStateKeys(a,b)},c.prototype.getChildMatchingStateKeys=function(a,b){return this._children[this.getChildIndexMatchingStateKeys(a,b)]},c.prototype.getChildIndexMatchingStateKeys=function(a,b){var c=-1;return this._children.forEach(function(d,e){d.getState().doesMatchStateKeys(a,b)&&(c=e)}),c},c.prototype.getChildMatchingStateId=function(a){return this._children[this.getChildIndexMatchingStateId(a)]},c.prototype.getChildIndexMatchingStateId=function(a){var b=-1;return this._children.forEach(function(c,d){c.getState().getId()==a&&(b=d)}),b},c.prototype.addChild=function(a){this._children.push(new c(a))},c.prototype.getChildren=function(){return this._children},c.prototype.removeChildAtIndex=function(a){this._children.splice(a,1)},c.prototype.getState=function(){return this._state},d.prototype.getStateTreeNodeAtIndexPath=function(a){if(0===a.length)return this._rootNode;for(var b=this._rootNode.getChildren()[a[0]],c=1;c<a.length;c++)b=b.getChildren()[a[c]];return b},d.prototype.getStateTreeNodeAtStateIdPath=function(a){if(0===a.length)return this._rootNode;for(var b=this._rootNode.getChildMatchingStateId(a[0]),c=1;c<a.length;c++)b=b.getChildMatchingStateId(a[c]);return b},d.prototype.pruneBranch=function(a){for(var b=a.length;b>0;b--){var c=a.slice(0,b),d=this.getStateTreeNodeAtStateIdPath(c);if(0!==d.getChildren().length||d.getState().hasCallback())return;this.removeNodeAtStateIdPath(c)}},d.prototype.removeNodeAtStateIdPath=function(a){var b=this.getStateTreeNodeAtStateIdPath(a.slice(0,a.length-1)),c=a[a.length-1];b.removeChildAtIndex(b.getChildIndexMatchingStateId(c))},d.prototype.clear=function(){this._rootNode=new c};var m,n,o,p={space:32,enter:13,"return":13,tab:9,esc:27,escape:27,backspace:8,shift:16,control:17,ctrl:17,alt:18,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,left:37,up:38,right:39,down:40,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90},q={timeThreshold:500},r=[],s=[],t=new d;a.addEventListener("keydown",e),a.addEventListener("keyup",g),a.decree={when:j,config:k,deregisterAll:l}}(window);